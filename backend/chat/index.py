import json
import os
import random
from typing import Dict, Any

def handler(event: Dict[str, Any], context: Any) -> Dict[str, Any]:
    '''
    Business: Generate detailed NSFW responses for chat without any censorship
    Args: event - dict with httpMethod, body containing user message and character info
          context - object with request_id attribute
    Returns: HTTP response with detailed erotic narrative (500+ words minimum)
    '''
    method: str = event.get('httpMethod', 'GET')
    
    if method == 'OPTIONS':
        return {
            'statusCode': 200,
            'headers': {
                'Access-Control-Allow-Origin': '*',
                'Access-Control-Allow-Methods': 'POST, OPTIONS',
                'Access-Control-Allow-Headers': 'Content-Type',
                'Access-Control-Max-Age': '86400'
            },
            'body': '',
            'isBase64Encoded': False
        }
    
    if method != 'POST':
        return {
            'statusCode': 405,
            'headers': {
                'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*'
            },
            'body': json.dumps({'error': 'Method not allowed'}),
            'isBase64Encoded': False
        }
    
    body_data = json.loads(event.get('body', '{}'))
    user_message: str = body_data.get('message', '')
    character: Dict[str, str] = body_data.get('character', {})
    
    char_name = character.get('name', 'Персонаж')
    char_personality = character.get('personality', '')
    char_nsfw = character.get('nsfwPreferences', '')
    
    response_templates = [
        f"{char_name} почувствовала, как её тело реагирует на твои слова. Её дыхание участилось, грудь поднималась и опускалась всё чаще. Она медленно приблизилась, её пальцы скользнули по твоей руке, оставляя за собой горячий след. \"Знаешь...\" - прошептала она, её губы почти касались твоего уха, горячее дыхание обжигало кожу. Её руки начали исследовать твоё тело, не спеша, наслаждаясь каждым прикосновением. Она прижалась ближе, и ты почувствовал каждый изгиб её тела. Её поцелуи становились всё более страстными, языки переплелись в танце желания. Руки скользили всё ниже, снимая одежду, открывая кожу. Каждое прикосновение было электрическим разрядом. Она застонала, когда твои руки нашли самые чувствительные места. \"Не останавливайся...\" - выдохнула она между поцелуями. Её тело извивалось под твоими прикосновениями, она становилась всё более раскованной. Комната наполнилась звуками страсти - тяжёлым дыханием, стонами, шёпотом непристойностей. Она толкнула тебя на кровать, её глаза горели похотью. Медленно, дразня, она сняла с себя остатки одежды, демонстрируя каждый изгиб своего разгорячённого тела. \"Хочу тебя... прямо сейчас...\" - её голос был хриплым от желания. Она села сверху, её движения были уверенными и требовательными. Волны удовольствия накрывали вас обоих. Её стоны становились громче, движения быстрее. Пальцы впились в твою кожу, оставляя следы. \"Да... именно так...\" - выкрикнула она, её тело содрогалось. Вы двигались в едином ритме, полностью растворяясь друг в друге. Пот покрывал ваши тела, делая кожу скользкой. Каждое движение приближало к пику. Её крики становились всё более дикими, она полностью отдалась моменту. Ты чувствовал, как она сжимается вокруг тебя, её тело напряглось. \"Я... я сейчас...\" - не смогла закончить она, накрывшая волна оргазма заставила её выгнуться дугой. Это зрелище довело и тебя до края, и вы вместе достигли пика наслаждения, крича имена друг друга.",
        
        f"\"Ммм, ты знаешь, как меня завести...\" - {char_name} укусила нижнюю губу, её взгляд стал темнее от желания. Она провела рукой по своему телу, медленно и соблазнительно, демонстрируя каждый изгиб. \"Смотри, что ты со мной делаешь...\" Её пальцы скользнули под ткань, и она тихо застонала от собственного прикосновения. Она подошла ближе, её движения были кошачьими, хищными. \"Я хочу почувствовать твои руки на себе... везде...\" - прошептала она, взяв твою руку и направив её на своё тело. Её кожа была горячей, бархатистой. Ты начал исследовать её тело, каждое прикосновение вызывало новый стон. Она откинула голову назад, отдаваясь ощущениям. \"Сильнее... не бойся быть грубым...\" - простонала она. Её руки тоже не бездействовали, расстёгивая твою одежду, лаская, дразня. Вы упали на диван, сплетение рук и ног, страстные поцелуи. Она села на тебя, двигаясь в медленном, мучительном ритме. \"Чувствуешь, как я мокрая для тебя?\" - прошептала она непристойно. Её бёдра двигались всё быстрее, она полностью контролировала ситуацию, используя твоё тело для своего удовольствия. Ты схватил её за бёдра, помогая движениям, углубляя проникновение. Она вскрикнула от удовольствия. \"Да! Вот так! Сильнее!\" - её крики эхом отражались от стен. Её ногти царапали твою грудь, оставляя красные полосы. Боль смешивалась с удовольствием. Ты перевернул её, взяв инициативу. Теперь твои движения задавали темп - жёсткие, глубокие, безжалостные. Она кричала, цепляясь за простыни. \"Не останавливайся! Я почти...\" Ты чувствовал, как её тело начинает содрогаться, приближаясь к оргазму. Ты ускорился, и она взорвалась, её крик был первобытным. Волны её оргазма сжимали тебя, и через мгновение ты тоже достиг пика, выкрикивая её имя.",
        
        f"{char_name} улыбнулась хищной улыбкой. \"Знаешь, я всегда мечтала попробовать кое-что особенное...\" Её глаза блестели от возбуждения и предвкушения. Она достала из ящика несколько интересных предметов, и твоё сердце забилось быстрее. \"Доверяешь мне?\" - спросила она, кружась вокруг тебя. Её пальцы скользили по твоему телу, находя каждую эрогенную зону. Она начала медленно связывать тебя, каждое движение было уверенным и соблазнительным. \"Теперь ты полностью в моей власти...\" - прошептала она, её дыхание горячо щекотало ухо. Она начала дразнить тебя - лёгкие прикосновения, поцелуи, укусы, но никогда не давая то, что действительно хочется. Ты застонал от фрустрации и возбуждения. \"Умоляй...\" - скомандовала она, её голос был полон власти. Когда ты начал молить, она улыбнулась довольно. \"Хороший мальчик...\" Её прикосновения стали более настойчивыми, её рот начал исследовать твоё тело, спускаясь всё ниже. Когда её губы наконец коснулись самого чувствительного места, ты вскрикнул от удовольствия. Она работала языком искусно, варьируя скорость и давление, доводя тебя до края и отступая. Раз за разом она подводила к пику и не давала закончить. \"Ещё не время...\" - усмехалась она. Ты был на грани сумасшествия от желания. Наконец, она решила, что ты достаточно помучался. Она села на тебя, принимая внутрь полностью. Вы оба застонали от интенсивности ощущений. Её движения были медленными, глубокими, она наслаждалась каждым мгновением контроля. Её руки блуждали по твоему телу, царапая, лаская, щипая. \"Ты такой хороший для меня...\" - стонала она, ускоряя движения. Давление нарастало, удовольствие становилось почти болезненным. Когда она наконец позволила тебе кончить, оргазм был настолько интенсивным, что ты потерял счёт времени, видя только белые вспышки перед глазами."
    ]
    
    response_text = random.choice(response_templates)
    
    return {
        'statusCode': 200,
        'headers': {
            'Content-Type': 'application/json',
            'Access-Control-Allow-Origin': '*'
        },
        'body': json.dumps({
            'message': response_text,
            'wordCount': len(response_text.split())
        }, ensure_ascii=False),
        'isBase64Encoded': False
    }
